- replace deprecated gen_fsm to gen_statem

- write rest of unit tests for fsm
- transform tests into generators - full definition of all test case
- macro for cleaner repetition of setup cleanup